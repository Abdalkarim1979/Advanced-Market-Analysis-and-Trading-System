<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ“ˆ Advanced Binance Trading System with Moving Averages</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
  <style>
    /* Save button */
    .save-btn-container {
      margin-top: 25px;
      text-align: center;
    }

    .save-btn {
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      padding: 12px 25px;
      border-radius: 8px;
      border: none;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .save-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(142, 68, 173, 0.4);
    }

    :root {
      --primary: #3498db;
      --success: #2ecc71;
      --danger: #e74c3c;
      --warning: #f39c12;
      --trend-up: #27ae60;
      --trend-down: #e74c3c;
      --trend-neutral: #3498db;
      --buy: rgba(46, 204, 113, 0.15);
      --sell: rgba(231, 76, 60, 0.15);
      --neutral: rgba(52, 152, 219, 0.15);
      --dark: #2c3e50;
      --light: #ecf0f1;
      --market-up: rgba(46, 204, 113, 0.2);
      --market-down: rgba(231, 76, 60, 0.2);
      --market-neutral: rgba(52, 152, 219, 0.2);
      --sma50: #F39C12;
      --sma200: #9B59B6;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Tahoma', sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #2c3e50);
      color: #fff;
      padding: 20px;
      min-height: 100vh;
      direction: ltr;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      padding: 20px 0;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .logo i {
      font-size: 2.5rem;
      background: linear-gradient(to right, #3498db, #2ecc71);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    h1 {
      font-size: 2.3rem;
      margin-bottom: 10px;
      background: linear-gradient(to right, #3498db, #2ecc71);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .subtitle {
      color: #bdc3c7;
      font-size: 1.1rem;
      margin-bottom: 20px;
      max-width: 800px;
      line-height: 1.6;
    }
    
    .card {
      background: rgba(44, 62, 80, 0.7);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .card-header {
      font-size: 1.4rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }
    
    label {
      margin-bottom: 8px;
      font-weight: 500;
      color: #ecf0f1;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    input, select {
      padding: 12px 15px;
      border: 2px solid rgba(52, 152, 219, 0.5);
      border-radius: 8px;
      background: rgba(25, 42, 86, 0.5);
      color: white;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
    }
    
    button {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
      background: linear-gradient(135deg, #2980b9, #3498db);
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 15px 0;
    }
    
    .btn-toggle {
      background: rgba(44, 62, 80, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .btn-toggle.active {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      border-color: rgba(46, 204, 113, 0.5);
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .summary-item {
      background: rgba(25, 42, 86, 0.5);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border-left: 4px solid;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .summary-item.bids {
      border-left-color: var(--success);
    }
    
    .summary-item.asks {
      border-left-color: var(--danger);
    }
    
    .summary-item.support {
      border-left-color: #9b59b6;
    }
    
    .summary-item.resist {
      border-left-color: #f39c12;
    }
    
    .summary-item.trend {
      border-left-color: var(--primary);
    }
    
    .summary-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: #ecf0f1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .summary-value {
      font-size: 1.8rem;
      font-weight: 700;
    }
    
    .support-resist-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .support-resist-card {
      background: rgba(25, 42, 86, 0.5);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .support-resist-card.support {
      border-top: 4px solid #9b59b6;
    }
    
    .support-resist-card.resist {
      border-top: 4px solid #f39c12;
    }
    
    .levels-list {
      list-style-type: none;
    }
    
    .level-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .level-item:last-child {
      border-bottom: none;
    }
    
    .level-price {
      font-weight: bold;
      font-size: 1.2rem;
    }
    
    .level-volume {
      background: rgba(255, 255, 255, 0.1);
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .tables {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .table-container {
      flex: 1;
      min-width: 300px;
      background: rgba(25, 42, 86, 0.5);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .table-header {
      padding: 15px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 600;
    }
    
    .table-header.bids {
      background: linear-gradient(90deg, rgba(46, 204, 113, 0.3), transparent);
      color: var(--success);
    }
    
    .table-header.asks {
      background: linear-gradient(90deg, rgba(231, 76, 60, 0.3), transparent);
      color: var(--danger);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(44, 62, 80, 0.3);
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
    }
    
    th {
      background: rgba(25, 42, 86, 0.6);
      font-weight: 600;
      color: #ecf0f1;
    }
    
    tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.05);
    }
    
    tr:hover {
      background: rgba(52, 152, 219, 0.2);
    }
    
    .chart-container {
      height: 450px;
      background: rgba(25, 42, 86, 0.5);
      border-radius: 12px;
      margin-bottom: 25px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      position: relative;
    }
    
    .chart-header {
      padding: 15px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 600;
      color: #ecf0f1;
      background: rgba(44, 62, 80, 0.3);
    }
    
    .hidden {
      display: none;
    }
    
    .footer {
      text-align: center;
      padding: 20px;
      color: #bdc3c7;
      font-size: 0.9rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 20px;
    }
    
    /* New trading suggestions system */
    .trading-suggestions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 25px;
    }
    
    @media (max-width: 900px) {
      .trading-suggestions {
        grid-template-columns: 1fr;
      }
    }
    
    .suggestion-card {
      background: rgba(25, 42, 86, 0.5);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    .suggestion-card.buy {
      border-top: 4px solid var(--success);
      background: var(--buy);
    }
    
    .suggestion-card.sell {
      border-top: 4px solid var(--danger);
      background: var(--sell);
    }
    
    .suggestion-card.neutral {
      border-top: 4px solid var(--primary);
      background: var(--neutral);
    }
    
    .suggestion-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .suggestion-icon {
      font-size: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .buy .suggestion-icon {
      background: rgba(46, 204, 113, 0.2);
      color: var(--success);
    }
    
    .sell .suggestion-icon {
      background: rgba(231, 76, 60, 0.2);
      color: var(--danger);
    }
    
    .neutral .suggestion-icon {
      background: rgba(52, 152, 219, 0.2);
      color: var(--primary);
    }
    
    .suggestion-title {
      font-size: 1.8rem;
      font-weight: 700;
    }
    
    .suggestion-details {
      margin-bottom: 20px;
    }
    
    .suggestion-reason {
      font-size: 1.1rem;
      line-height: 1.7;
      margin-bottom: 15px;
      color: #ecf0f1;
    }
    
    .suggestion-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 8px 0;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #bdc3c7;
    }
    
    .profit-percentage {
      font-size: 1rem;
      margin-top: 5px;
      font-weight: 600;
    }
    
    .profit-percentage.positive {
      color: var(--success);
    }
    
    .profit-percentage.negative {
      color: var(--danger);
    }
    
    .suggestion-history {
      margin-top: 30px;
    }
    
    .history-title {
      font-size: 1.3rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .history-list {
      max-height: 200px;
      overflow-y: auto;
      padding-right: 10px;
    }
    
    .history-item {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .history-item:last-child {
      border-bottom: none;
    }
    
    .history-action {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      min-width: 80px;
    }
    
    .history-action.buy {
      color: var(--success);
    }
    
    .history-action.sell {
      color: var(--danger);
    }
    
    .history-details {
      font-size: 0.9rem;
      color: #bdc3c7;
      flex-grow: 1;
      margin: 0 15px;
    }
    
    .history-percentage {
      min-width: 80px;
      text-align: left;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .history-percentage.positive {
      color: var(--success);
    }
    
    .history-percentage.negative {
      color: var(--danger);
    }
    
    /* Indicators */
    .strength-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
    }
    
    .indicator-bar {
      flex-grow: 1;
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
    }
    
    .indicator-fill {
      height: 100%;
      border-radius: 5px;
    }
    
    .support .indicator-fill {
      background: linear-gradient(to right, #9b59b6, #8e44ad);
    }
    
    .resist .indicator-fill {
      background: linear-gradient(to right, #f39c12, #e67e22);
    }
    
    .indicator-value {
      min-width: 50px;
      text-align: left;
      font-weight: 600;
    }
    
    /* Alerts */
    .alert-banner {
      padding: 15px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 20px 0;
      animation: pulse 2s infinite;
    }
    
    .alert-banner.buy {
      background: rgba(46, 204, 113, 0.2);
      border: 1px solid var(--success);
    }
    
    .alert-banner.sell {
      background: rgba(231, 76, 60, 0.2);
      border: 1px solid var(--danger);
    }
    
    .alert-content {
      flex-grow: 1;
    }
    
    .alert-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .alert-message {
      font-size: 1rem;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); }
      100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
    }
    
    /* Market trend analysis */
    .market-trend {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .trend-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 25px;
      border-radius: 15px;
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .trend-indicator.up {
      background: var(--market-up);
      color: var(--trend-up);
      border: 2px solid var(--trend-up);
    }
    
    .trend-indicator.down {
      background: var(--market-down);
      color: var(--trend-down);
      border: 2px solid var(--trend-down);
    }
    
    .trend-indicator.neutral {
      background: var(--market-neutral);
      color: var(--trend-neutral);
      border: 2px solid var(--trend-neutral);
    }
    
    .trend-analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .analysis-card {
      background: rgba(25, 42, 86, 0.5);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .analysis-card .header {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.2rem;
      font-weight: 600;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .analysis-values {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .analysis-value {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .value-label {
      font-size: 0.9rem;
      color: #bdc3c7;
      margin-bottom: 5px;
    }
    
    .value-number {
      font-size: 1.3rem;
      font-weight: 700;
    }
    
    .value-number.positive {
      color: var(--trend-up);
    }
    
    .value-number.negative {
      color: var(--trend-down);
    }
    
    .value-number.neutral {
      color: var(--trend-neutral);
    }
    
    .trend-recommendation {
      padding: 15px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      margin-top: 10px;
    }
    
    .recommendation-title {
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .recommendation-text {
      line-height: 1.6;
    }
    
    /* Mobile improvements */
    @media (max-width: 768px) {
      .tables {
        flex-direction: column;
      }
      
      .chart-container {
        height: 350px;
      }
      
      .summary-grid, .support-resist-container, .trend-analysis-grid {
        grid-template-columns: 1fr;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .suggestion-header {
        flex-direction: column;
        text-align: center;
      }
      
      .suggestion-stats {
        grid-template-columns: 1fr;
      }
      
      .trading-suggestions {
        grid-template-columns: 1fr;
      }
      
      .history-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .history-percentage {
        margin-top: 5px;
        text-align: right;
      }
    }
    
    /* New modifications */
    .currency-price {
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin: 20px 0;
      background: linear-gradient(135deg, #3498db, #2ecc71);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    .price-change {
      font-size: 1.2rem;
      font-weight: 600;
      padding: 5px 15px;
      border-radius: 20px;
      margin-left: 15px;
    }
    
    .price-change.positive {
      background: rgba(46, 204, 113, 0.2);
      color: var(--success);
    }
    
    .price-change.negative {
      background: rgba(231, 76, 60, 0.2);
      color: var(--danger);
    }
    
    .currency-info {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .currency-name {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(135deg, #9b59b6, #3498db);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .currency-symbol {
      font-size: 1.2rem;
      background: rgba(255, 255, 255, 0.1);
      padding: 5px 15px;
      border-radius: 20px;
    }
    
    .currency-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .currency-btn {
      padding: 8px 15px;
      border-radius: 20px;
      background: rgba(25, 42, 86, 0.5);
      border: 1px solid rgba(52, 152, 219, 0.5);
      color: #ecf0f1;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .currency-btn:hover {
      background: rgba(52, 152, 219, 0.3);
      transform: translateY(-2px);
    }
    
    .currency-btn.active {
      background: linear-gradient(135deg, #3498db, #2ecc71);
      border-color: rgba(46, 204, 113, 0.5);
    }
    
    .currency-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(25, 42, 86, 0.5);
      border-radius: 8px;
      padding: 0 15px;
    }
    
    .currency-input-group i {
      color: #3498db;
    }
    /* Add this for the new button */
    .save-btn i.fa-video {
      margin-left: 8px;
    }
    
    /* Video alerts */
    .alert-banner.success {
      background: rgba(46, 204, 113, 0.2);
      border: 1px solid var(--success);
    }
    
    .alert-banner.warning {
      background: rgba(241, 196, 15, 0.2);
      border: 1px solid #f1c40f;
    }
    /* Save analysis button styling */
    .card-header .save-btn {
      margin-left: 15px;
      padding: 8px 15px;
      font-size: 0.9rem;
      background: linear-gradient(135deg, #3498db, #2980b9) !important;
    }
    
    .card-header .save-btn i {
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-chart-line"></i>
        <div>
          <h1>Advanced Market Analysis and Trading System</h1>
          <p class="subtitle">Order book monitoring with market trend analysis and intelligent trading suggestions using moving averages</p>
        </div>
      </div>
    </header>
    
    <!-- Currency price display section -->
    <div class="card">
      <div class="card-header">
        <i class="fas fa-coins"></i>
        <span>Currency Price</span>
      </div>
      
      <div class="currency-info">
        <div class="currency-name" id="currency-name">Bitcoin</div>
        <div class="currency-symbol" id="currency-symbol">BTC/USDT</div>
      </div>
      
      <div class="currency-price">
        <span id="current-price">--</span>
        <span class="price-change" id="price-change-percent">--%</span>
      </div>
      
      <div class="currency-selector">
        <!-- Will be populated dynamically -->
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <i class="fas fa-sliders-h"></i>
        <span>Trading Settings</span>
      </div>
      
      <div id="controls">
     
        <div class="control-group">
          <label for="limit-input"><i class="fas fa-ruler"></i> Order Book Size</label>
          <input id="limit-input" type="number" value="1000" min="100" max="5000" />
        </div>
        
        <div class="control-group">
          <label for="strategy-select"><i class="fas fa-chess-knight"></i> Trading Strategy</label>
          <select id="strategy-select">
            <option value="balanced">Balanced (Recommended)</option>
            <option value="aggressive">Aggressive (High Risk)</option>
            <option value="conservative">Conservative (Low Risk)</option>
          </select>
        </div>
        
        <div class="control-group">
          <label>&nbsp;</label>
          <button id="load-btn">
            <i class="fas fa-download"></i> Load Data
          </button>
        </div>
      </div>
      
      <div class="btn-group">
        <button id="toggle-bids-btn" class="btn-toggle">
          <i class="fas fa-table"></i> Show Bids Table
        </button>
        <button id="toggle-asks-btn" class="btn-toggle">
          <i class="fas fa-table"></i> Show Asks Table
        </button>
        <button id="toggle-charts-btn" class="btn-toggle">
          <i class="fas fa-chart-bar"></i> Show Charts
        </button>
        <button id="toggle-price-chart-btn" class="btn-toggle">
          <i class="fas fa-chart-line"></i> Show Price Chart
        </button>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <i class="fas fa-tachometer-alt"></i>
        <span>Market Indicators</span>
      </div>
      
      <div class="summary-grid">
        <div class="summary-item bids">
          <div class="summary-title"><i class="fas fa-arrow-up"></i> Total Bids</div>
          <div class="summary-value" id="total-bids">0</div>
          <div class="summary-title">Highest Bid: <span id="highest-bid">--</span></div>
        </div>
        
        <div class="summary-item asks">
          <div class="summary-title"><i class="fas fa-arrow-down"></i> Total Asks</div>
          <div class="summary-value" id="total-asks">0</div>
          <div class="summary-title">Lowest Ask: <span id="lowest-ask">--</span></div>
        </div>
        
        <div class="summary-item support">
          <div class="summary-title"><i class="fas fa-shield-alt"></i> Strongest Support</div>
          <div class="summary-value" id="strong-support">--</div>
          <div class="summary-title">Support Strength: <span id="support-strength">--</span></div>
        </div>
        
        <div class="summary-item resist">
          <div class="summary-title"><i class="fas fa-mountain"></i> Strongest Resistance</div>
          <div class="summary-value" id="strong-resist">--</div>
          <div class="summary-title">Resistance Strength: <span id="resist-strength">--</span></div>
        </div>
      </div>
      
      <div class="support-resist-container">
        <div class="support-resist-card support">
          <div class="card-header">
            <i class="fas fa-shield-alt"></i>
            <span>Top 3 Support Levels</span>
          </div>
          <ul class="levels-list" id="top-supports">
            <li class="level-item">
              <div>--</div>
              <div>--</div>
            </li>
            <li class="level-item">
              <div>--</div>
              <div>--</div>
            </li>
            <li class="level-item">
              <div>--</div>
              <div>--</div>
            </li>
          </ul>
          
          <div class="strength-indicator">
            <span>Support Strength:</span>
            <div class="indicator-bar">
              <div class="indicator-fill" id="support-indicator" style="width: 0%"></div>
            </div>
            <div class="indicator-value" id="support-value">0%</div>
          </div>
        </div>
        
        <div class="support-resist-card resist">
          <div class="card-header">
            <i class="fas fa-mountain"></i>
            <span>Top 3 Resistance Levels</span>
          </div>
          <ul class="levels-list" id="top-resists">
            <li class="level-item">
              <div>--</div>
              <div>--</div>
            </li>
            <li class="level-item">
              <div>--</div>
              <div>--</div>
            </li>
            <li class="level-item">
              <div>--</div>
              <div>--</div>
            </li>
          </ul>
          
          <div class="strength-indicator">
            <span>Resistance Strength:</span>
            <div class="indicator-bar">
              <div class="indicator-fill" id="resist-indicator" style="width: 0%"></div>
            </div>
            <div class="indicator-value" id="resist-value">0%</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- New market trend analysis -->
    <div class="card">
        <div class="card-header">
    <i class="fas fa-chart-line"></i>
    <span>Market Trend Analysis</span>
    <button class="save-btn" onclick="saveMarketAnalysis()" style="margin-right: auto;">
      <i class="fas fa-file-alt"></i> Save Analysis as Text
    </button>
  </div>
     
      
      <div class="market-trend">
        <div class="trend-indicator" id="market-trend-indicator">
          <i class="fas fa-chart-line"></i>
          <span id="trend-text">Analyzing market trend...</span>
        </div>
        
        <div class="trend-analysis-grid">
          <div class="analysis-card">
            <div class="header">
              <i class="fas fa-exchange-alt"></i>
              <span>Price Change (24h)</span>
            </div>
            <div class="analysis-values">
              <div class="analysis-value">
                <div class="value-label">Absolute Change</div>
                <div class="value-number" id="price-change">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">Percentage</div>
                <div class="value-number" id="price-change-percent1">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">High Price</div>
                <div class="value-number" id="high-price">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">Low Price</div>
                <div class="value-number" id="low-price">--</div>
              </div>
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="header">
              <i class="fas fa-money-bill-wave"></i>
              <span>Trading Volume</span>
            </div>
            <div class="analysis-values">
              <div class="analysis-value">
                <div class="value-label">Volume (24h)</div>
                <div class="value-number" id="volume-24h">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">Volume Change</div>
                <div class="value-number" id="volume-change">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">Average Volume</div>
                <div class="value-number" id="avg-volume">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">Liquidity Ratio</div>
                <div class="value-number" id="liquidity-ratio">--</div>
              </div>
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="header">
              <i class="fas fa-balance-scale"></i>
              <span>Trend Indicators</span>
            </div>
            <div class="analysis-values">
              <div class="analysis-value">
                <div class="value-label">Trend Strength</div>
                <div class="value-number" id="trend-strength">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">Momentum</div>
                <div class="value-number" id="momentum">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">Volatility</div>
                <div class="value-number" id="volatility">--</div>
              </div>
              <div class="analysis-value">
                <div class="value-label">RSI</div>
                <div class="value-number" id="rsi">--</div>
              </div>
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="header">
              <i class="fas fa-lightbulb"></i>
              <span>Trading Recommendations</span>
            </div>
            <div class="trend-recommendation">
              <div class="recommendation-title">
                <i class="fas fa-bullhorn"></i>
                <span>Recommendation Based on Trend</span>
              </div>
              <div class="recommendation-text" id="trend-recommendation">
                Analyzing market trend and generating recommendations...
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Intelligent trading suggestions system -->
    <div class="card">
      <div class="card-header">
        <i class="fas fa-lightbulb"></i>
        <span>Intelligent Trading Suggestions</span>
      </div>
      
      <div id="trading-alert"></div>
      
      <div class="trading-suggestions">
        <div class="suggestion-card" id="buy-suggestion">
          <div class="suggestion-header">
            <div class="suggestion-icon">
              <i class="fas fa-arrow-up"></i>
            </div>
            <div>
              <div class="suggestion-title">Buy Trade</div>
             
            </div>
          </div>
          
          <div class="suggestion-details">
            <div class="suggestion-reason" id="buy-reason">
              Analyzing order book...
            </div>
            
            <div class="suggestion-stats">
              <div class="stat-card">
                <div class="stat-label">Suggested Entry Price</div>
                <div class="stat-value" id="buy-entry">--</div>
                <div class="profit-percentage" id="buy-entry-percentage">--</div>
              </div>
              
              <div class="stat-card">
                <div class="stat-label">Stop Loss</div>
                <div class="stat-value" id="buy-stop">--</div>
                <div class="profit-percentage" id="buy-stop-percentage">--</div>
              </div>
              
              <div class="stat-card">
                <div class="stat-label">Profit Target 1</div>
                <div class="stat-value" id="buy-target1">--</div>
                <div class="profit-percentage" id="buy-target1-percentage">--</div>
              </div>
              
              <div class="stat-card">
                <div class="stat-label">Profit Target 2</div>
                <div class="stat-value" id="buy-target2">--</div>
                <div class="profit-percentage" id="buy-target2-percentage">--</div>
              </div>
            </div>
          <div class="save-btn-container">
<div class="save-btn-container">
  <button class="save-btn" onclick="saveAsImage('buy-suggestion')">
    <i class="fas fa-download"></i> Save as Image
  </button>
  <button class="save-btn" onclick="saveAsText('buy-suggestion')" style="margin-right: 10px;">
    <i class="fas fa-file-alt"></i> Save as Text
  </button>
  <button class="save-btn" onclick="startVideoRecording('buy-suggestion')" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
    <i class="fas fa-video"></i> Record Video
  </button>
</div>
</div>
          </div>
        </div>
        
        <div class="suggestion-card" id="sell-suggestion">
          <div class="suggestion-header">
            <div class="suggestion-icon">
              <i class="fas fa-arrow-down"></i>
            </div>
            <div>
              <div class="suggestion-title">Sell Trade</div>
              
            </div>
          </div>
          
          <div class="suggestion-details">
            <div class="suggestion-reason" id="sell-reason">
              Analyzing order book...
            </div>
            
            <div class="suggestion-stats">
              <div class="stat-card">
                <div class="stat-label">Suggested Entry Price</div>
                <div class="stat-value" id="sell-entry">--</div>
                <div class="profit-percentage" id="sell-entry-percentage">--</div>
              </div>
              
              <div class="stat-card">
                <div class="stat-label">Stop Loss</div>
                <div class="stat-value" id="sell-stop">--</div>
                <div class="profit-percentage" id="sell-stop-percentage">--</div>
              </div>
              
              <div class="stat-card">
                <div class="stat-label">Profit Target 1</div>
                <div class="stat-value" id="sell-target1">--</div>
                <div class="profit-percentage" id="sell-target1-percentage">--</div>
              </div>
              
              <div class="stat-card">
                <div class="stat-label">Profit Target 2</div>
                <div class="stat-value" id="sell-target2">--</div>
                <div class="profit-percentage" id="sell-target2-percentage">--</div>
              </div>
            </div>
          </div>
       <div class="save-btn-container">
 <!-- In the sell suggestion section -->
<div class="save-btn-container">
  <button class="save-btn" onclick="saveAsImage('sell-suggestion')">
    <i class="fas fa-download"></i> Save as Image
  </button>
  <button class="save-btn" onclick="saveAsText('sell-suggestion')" style="margin-right: 10px;">
    <i class="fas fa-file-alt"></i> Save as Text
  </button>
  <button class="save-btn" onclick="startVideoRecording('sell-suggestion')" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
    <i class="fas fa-video"></i> Record Video
  </button>
</div>
</div>
        </div>
      </div>
      
      <div class="suggestion-history">
        <div class="history-title">
          <i class="fas fa-history"></i>
          <span>Suggestion History</span>
        </div>
        <div class="history-list" id="suggestion-history">
          <!-- Will be populated dynamically -->
        </div>
      </div>
    </div>
    
    <div class="tables">
      <div class="table-container hidden" id="bids-container">
        <div class="table-header bids"><i class="fas fa-arrow-up"></i> Bids (Buy)</div>
        <table id="bids-table">
          <thead>
            <tr>
              <th>Price</th>
              <th>Quantity</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      
      <div class="table-container hidden" id="asks-container">
        <div class="table-header asks"><i class="fas fa-arrow-down"></i> Asks (Sell)</div>
        <table id="asks-table">
          <thead>
            <tr>
              <th>Price</th>
              <th>Quantity</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
      <div class="chart-header hidden" id="bids-chart-container_label"><i class="fas fa-chart-bar"></i> Bids by Price</div>
    <div class="chart-container hidden" id="bids-chart-container">
    
      <canvas id="bidsChart"></canvas>
    </div>
        <div class="chart-header hidden" id="asks-chart-container_label"><i class="fas fa-chart-bar"></i> Asks by Price</div> 
    <div class="chart-container hidden" id="asks-chart-container">
 
      <canvas id="asksChart"></canvas>
    </div>
     <div class="chart-header hidden" id="price-chart-container_label"><i class="fas fa-chart-line"></i> Live Price</div>
    <div class="chart-container hidden" id="price-chart-container">
   
      <canvas id="priceChart"></canvas>
    </div>
    
    
    <div class="footer">
        
      <p>Developed using Binance API | Auto-update every 5 seconds</p>
      <p>Note: Suggestions are for educational purposes only and not financial advice</p>
    </div>
  </div>

  <script>
    // DOM elements
    const inputSymbol = document.getElementById("symbol-input");
    const inputLimit = document.getElementById("limit-input");
    const strategySelect = document.getElementById("strategy-select");
    const loadBtn = document.getElementById("load-btn");
    const currentPriceEl = document.getElementById("current-price");
    const priceChangePercentEl1 = document.getElementById("price-change-percent1");
    const currencyNameEl = document.getElementById("currency-name");
    const currencySymbolEl = document.getElementById("currency-symbol");
    const currencySelector = document.querySelector(".currency-selector");
    
    const bidsTable = document.querySelector("#bids-table tbody");
    const asksTable = document.querySelector("#asks-table tbody");
    const totalBidsSpan = document.getElementById("total-bids");
    const totalAsksSpan = document.getElementById("total-asks");
    const highestBidSpan = document.getElementById("highest-bid");
    const lowestAskSpan = document.getElementById("lowest-ask");
    const supportSpan = document.getElementById("strong-support");
    const resistSpan = document.getElementById("strong-resist");
    const supportStrengthSpan = document.getElementById("support-strength");
    const resistStrengthSpan = document.getElementById("resist-strength");
    const topSupportsList = document.getElementById("top-supports");
    const topResistsList = document.getElementById("top-resists");
    
    // Display control elements
    const toggleBidsBtn = document.getElementById('toggle-bids-btn');
    const toggleAsksBtn = document.getElementById('toggle-asks-btn');
    const toggleChartsBtn = document.getElementById('toggle-charts-btn');
    const togglePriceChartBtn = document.getElementById('toggle-price-chart-btn');
    
    const bidsContainer = document.getElementById('bids-container');
    const asksContainer = document.getElementById('asks-container');
    const bidsChartContainer = document.getElementById('bids-chart-container');
    const bidsChartContainerlabel = document.getElementById('bids-chart-container_label');
    const asksChartContainer = document.getElementById('asks-chart-container');
    const asksChartContainerlabel = document.getElementById('asks-chart-container_label');
    const priceChartContainer = document.getElementById('price-chart-container');
    const priceChartContainerlabel = document.getElementById('price-chart-container_label');
    // Suggestion system elements
    const buySuggestionCard = document.getElementById('buy-suggestion');
    const sellSuggestionCard = document.getElementById('sell-suggestion');
    const buyReason = document.getElementById('buy-reason');
    const sellReason = document.getElementById('sell-reason');
    const buyEntry = document.getElementById('buy-entry');
    const sellEntry = document.getElementById('sell-entry');
    const buyStop = document.getElementById('buy-stop');
    const sellStop = document.getElementById('sell-stop');
    const buyTarget1 = document.getElementById('buy-target1');
    const sellTarget1 = document.getElementById('sell-target1');
    const buyTarget2 = document.getElementById('buy-target2');
    const sellTarget2 = document.getElementById('sell-target2');
    const suggestionHistory = document.getElementById('suggestion-history');
    const tradingAlert = document.getElementById('trading-alert');
    const supportIndicator = document.getElementById('support-indicator');
    const resistIndicator = document.getElementById('resist-indicator');
    const supportValue = document.getElementById('support-value');
    const resistValue = document.getElementById('resist-value');
    
    // Percentage elements
    const buyEntryPercentage = document.getElementById('buy-entry-percentage');
    const buyStopPercentage = document.getElementById('buy-stop-percentage');
    const buyTarget1Percentage = document.getElementById('buy-target1-percentage');
    const buyTarget2Percentage = document.getElementById('buy-target2-percentage');
    const sellEntryPercentage = document.getElementById('sell-entry-percentage');
    const sellStopPercentage = document.getElementById('sell-stop-percentage');
    const sellTarget1Percentage = document.getElementById('sell-target1-percentage');
    const sellTarget2Percentage = document.getElementById('sell-target2-percentage');
    
    // Market trend analysis elements
    const marketTrendIndicator = document.getElementById('market-trend-indicator');
    const trendText = document.getElementById('trend-text');
    const priceChangeEl = document.getElementById('price-change');
  const priceChangePercentEl = document.getElementById('price-change-percent');
    const highPriceEl = document.getElementById('high-price');
    const lowPriceEl = document.getElementById('low-price');
    const volume24hEl = document.getElementById('volume-24h');
    const volumeChangeEl = document.getElementById('volume-change');
    const avgVolumeEl = document.getElementById('avg-volume');
    const liquidityRatioEl = document.getElementById('liquidity-ratio');
    const trendStrengthEl = document.getElementById('trend-strength');
    const momentumEl = document.getElementById('momentum');
    const volatilityEl = document.getElementById('volatility');
    const rsiEl = document.getElementById('rsi');
    const trendRecommendation = document.getElementById('trend-recommendation');
    
    // Display states (hidden by default)
    let bidsVisible = false;
    let asksVisible = false;
    let chartsVisible = false;
    let priceChartVisible = false;
    
    // Suggestion history
    let tradeSuggestionsHistory = [];
    
    // Update button texts
    toggleBidsBtn.textContent = bidsVisible ? 'Hide Bids Table' : 'Show Bids Table';
    toggleAsksBtn.textContent = asksVisible ? 'Hide Asks Table' : 'Show Asks Table';
    toggleChartsBtn.textContent = chartsVisible ? 'Hide Charts' : 'Show Charts';
    togglePriceChartBtn.textContent = priceChartVisible ? 'Hide Price Chart' : 'Show Price Chart';
    
    // Popular cryptocurrencies list
    const popularCurrencies = [
      { symbol: 'BTCUSDT', name: 'Bitcoin', pair: 'BTC/USDT' },
      { symbol: 'ETHUSDT', name: 'Ethereum', pair: 'ETH/USDT' },
      { symbol: 'BNBUSDT', name: 'Binance Coin', pair: 'BNB/USDT' },
      { symbol: 'SOLUSDT', name: 'Solana', pair: 'SOL/USDT' },
      { symbol: 'XRPUSDT', name: 'Ripple', pair: 'XRP/USDT' },
      { symbol: 'ADAUSDT', name: 'Cardano', pair: 'ADA/USDT' },
      { symbol: 'DOGEUSDT', name: 'Dogecoin', pair: 'DOGE/USDT' },
      { symbol: 'AVAXUSDT', name: 'Avalanche', pair: 'AVAX/USDT' },
      { symbol: 'DOTUSDT', name: 'Polkadot', pair: 'DOT/USDT' },
      { symbol: 'LINKUSDT', name: 'Chainlink', pair: 'LINK/USDT' },
      { symbol: 'POLUSDT', name: 'Polygon', pair: 'POL/USDT' },
      { symbol: 'TRXUSDT', name: 'Tron', pair: 'TRX/USDT' },
      { symbol: 'LTCUSDT', name: 'Litecoin', pair: 'LTC/USDT' },
      { symbol: 'ATOMUSDT', name: 'Cosmos', pair: 'ATOM/USDT' },
      { symbol: 'NEARUSDT', name: 'Near Protocol', pair: 'NEAR/USDT' },
      { symbol: 'XLMUSDT', name: 'Stellar', pair: 'XLM/USDT' },
      { symbol: 'ALGOUSDT', name: 'Algorand', pair: 'ALGO/USDT' },
      { symbol: 'ICPUSDT', name: 'Internet Computer', pair: 'ICP/USDT' },
      { symbol: 'VETUSDT', name: 'VeChain', pair: 'VET/USDT' },
      { symbol: 'FILUSDT', name: 'Filecoin', pair: 'FIL/USDT' },
      { symbol: 'XNOUSDT', name: 'Nano', pair: 'XNO/USDT' },
       { symbol: 'SUSDT', name: 'Sonk', pair: 'S/USDT' },
        { symbol: 'ZECUSDT', name: 'Zcash', pair: 'ZCASH/USDT' },
         { symbol: 'TRUMPUSDT', name: 'Trump', pair: 'TRUMP/USDT' },
          { symbol: 'LTCUSDT', name: 'Litecoin', pair: 'LTC/USDT' }
    ];
    
    // Function to determine if currency is large cap
    function isLargeCap(symbol) {
      const largeCaps = ['BTCUSDT', 'ETHUSDT', 'BNBUSDT'];
      return largeCaps.includes(symbol);
    }
    
    // Create currency buttons
    function createCurrencyButtons() {
      popularCurrencies.forEach(currency => {
        const button = document.createElement('button');
        button.className = 'currency-btn';
        button.textContent = currency.pair;
        button.dataset.symbol = currency.symbol;
        button.dataset.name = currency.name;
        button.dataset.pair = currency.pair;
        
        button.addEventListener('click', () => {
          // Remove active from all buttons
          document.querySelectorAll('.currency-btn').forEach(btn => {
            btn.classList.remove('active');
          });
          
          // Add active to current button
          button.classList.add('active');
          
          // Update UI
          currencyNameEl.textContent = currency.name;
          currencySymbolEl.textContent = currency.pair;
          
          // Update symbol
          currentSymbol = currency.symbol;
          
          // Load currency data
          updateOrderBook(currentSymbol, currentLimit);
        });
        
        currencySelector.appendChild(button);
      });
      
      // Set first button as active
      if (popularCurrencies.length > 0) {
        currencySelector.querySelector('.currency-btn').classList.add('active');
        currencyNameEl.textContent = popularCurrencies[0].name;
        currencySymbolEl.textContent = popularCurrencies[0].pair;
      }
    }
    
    // Toggle bids table
    toggleBidsBtn.addEventListener('click', () => {
      bidsVisible = !bidsVisible;
      bidsContainer.classList.toggle('hidden', !bidsVisible);
      toggleBidsBtn.textContent = bidsVisible ? 'Hide Bids Table' : 'Show Bids Table';
      toggleBidsBtn.classList.toggle('active', bidsVisible);
    });
    
    // Toggle asks table
    toggleAsksBtn.addEventListener('click', () => {
      asksVisible = !asksVisible;
      asksContainer.classList.toggle('hidden', !asksVisible);
      toggleAsksBtn.textContent = asksVisible ? 'Hide Asks Table' : 'Show Asks Table';
      toggleAsksBtn.classList.toggle('active', asksVisible);
    });
    
    // Toggle charts
    toggleChartsBtn.addEventListener('click', () => {
      chartsVisible = !chartsVisible;
      bidsChartContainer.classList.toggle('hidden', !chartsVisible);
      asksChartContainer.classList.toggle('hidden', !chartsVisible);
        bidsChartContainerlabel.classList.toggle('hidden', !chartsVisible);
      asksChartContainerlabel.classList.toggle('hidden', !chartsVisible);
      toggleChartsBtn.textContent = chartsVisible ? 'Hide Charts' : 'Show Charts';
      toggleChartsBtn.classList.toggle('active', chartsVisible);
    });
    
    // Toggle price chart
    togglePriceChartBtn.addEventListener('click', () => {
      priceChartVisible = !priceChartVisible;
      priceChartContainer.classList.toggle('hidden', !priceChartVisible);
         priceChartContainerlabel.classList.toggle('hidden', !priceChartVisible);
      togglePriceChartBtn.textContent = priceChartVisible ? 'Hide Price Chart' : 'Show Price Chart';
      togglePriceChartBtn.classList.toggle('active', priceChartVisible);
    });
    
    let currentSymbol = "BTCUSDT";
    let currentLimit = parseInt(inputLimit.value);
    let currentPrice = 0;
    
    // Create charts
    const bidsChart = new Chart(
      document.getElementById('bidsChart').getContext('2d'),
      {
        type: "bar",
        data: {
          labels: [],
          datasets: [{ 
            label: "Bids", 
            data: [], 
            backgroundColor: "rgba(46, 204, 113, 0.7)",
            borderColor: "rgba(39, 174, 96, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { 
              title: { 
                display: true, 
                text: "Price",
                color: '#ecf0f1',
                font: { size: 14 }
              },
              ticks: { 
                color: '#bdc3c7',
                font: { size: 12 } 
              }
            },
            y: { 
              beginAtZero: true, 
              title: { 
                display: true, 
                text: "Quantity",
                color: '#ecf0f1',
                font: { size: 14 }
              },
              ticks: { 
                color: '#bdc3c7',
                font: { size: 12 } 
              }
            }
          }
        }
      }
    );
    
    const asksChart = new Chart(
      document.getElementById('asksChart').getContext('2d'),
      {
        type: "bar",
        data: {
          labels: [],
          datasets: [{ 
            label: "Asks", 
            data: [], 
            backgroundColor: "rgba(231, 76, 60, 0.7)",
            borderColor: "rgba(192, 57, 43, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { 
              title: { 
                display: true, 
                text: "Price",
                color: '#ecf0f1',
                font: { size: 14 }
              },
              ticks: { 
                color: '#bdc3c7',
                font: { size: 12 } 
              }
            },
            y: { 
              beginAtZero: true, 
              title: { 
                display: true, 
                text: "Quantity",
                color: '#ecf0f1',
                font: { size: 14 }
              },
              ticks: { 
                color: '#bdc3c7',
                font: { size: 12 } 
              }
            }
          }
        }
      }
    );
    
    const priceChart = new Chart(
      document.getElementById('priceChart').getContext('2d'),
      {
        type: "line",
        data: {
          labels: [],
          datasets: [
            { 
              label: "Current Price", 
              data: [], 
              borderColor: "rgba(52, 152, 219, 1)", 
              backgroundColor: "rgba(52, 152, 219, 0.1)",
              borderWidth: 3,
              fill: true
            },
            { 
              label: "Highest Bid", 
              data: [], 
              borderColor: "rgba(46, 204, 113, 1)", 
              borderDash: [5, 5],
              borderWidth: 2,
              fill: false
            },
            { 
              label: "Lowest Ask", 
              data: [], 
              borderColor: "rgba(231, 76, 60, 1)", 
              borderDash: [5, 5],
              borderWidth: 2,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: '#ecf0f1',
                font: { size: 13 }
              }
            }
          },
          scales: {
            x: { 
              title: { 
                display: true, 
                text: "Time",
                color: '#ecf0f1',
                font: { size: 14 }
              },
              ticks: { 
                color: '#bdc3c7',
                font: { size: 12 } 
              }
            },
            y: {
              title: { 
                display: true, 
                text: "Price",
                color: '#ecf0f1',
                font: { size: 14 }
              },
              ticks: { 
                callback: v => parseFloat(v).toFixed(4),
                color: '#bdc3c7',
                font: { size: 12 } 
              }
            }
          }
        }
      }
    );
    
    // Simple Moving Average (SMA) calculation function
    function calculateSMA(data, period) {
      const sma = [];
      for (let i = period - 1; i < data.length; i++) {
        const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
        sma.push(sum / period);
      }
      return sma;
    }
    
    // Function to update chart with moving averages
    function updateChartWithMovingAverages(closingPrices, sma50, sma200) {
      // Remove old moving averages if they exist
      priceChart.data.datasets = priceChart.data.datasets.filter(ds => 
        !['SMA 50', 'SMA 200'].includes(ds.label)
      );
      
      // Add new moving averages
      priceChart.data.datasets.push({
        label: "SMA 50",
        data: closingPrices.map((_, i) => 
          i >= closingPrices.length - sma50.length ? sma50[i - (closingPrices.length - sma50.length)] : null
        ),
        borderColor: "#F39C12",
        borderWidth: 2,
        pointRadius: 0,
        fill: false
      });
      
      priceChart.data.datasets.push({
        label: "SMA 200",
        data: closingPrices.map((_, i) => 
          i >= closingPrices.length - sma200.length ? sma200[i - (closingPrices.length - sma200.length)] : null
        ),
        borderColor: "#9B59B6",
        borderWidth: 2,
        pointRadius: 0,
        fill: false
      });
      
      priceChart.update();
    }
    
    // Market trend analysis function
    function analyzeMarketTrend(tickerData, orderBook, closingPrices) {
      const priceChange = parseFloat(tickerData.priceChange);
      const priceChangePercent = parseFloat(tickerData.priceChangePercent);
      const highPrice = parseFloat(tickerData.highPrice);
      const lowPrice = parseFloat(tickerData.lowPrice);
      const volume = parseFloat(tickerData.volume);
      
      // Update market analysis data
      priceChangeEl.textContent = `${priceChange.toFixed(4)}`;
      priceChangePercentEl.textContent = `${priceChangePercent.toFixed(2)}%`;
      highPriceEl.textContent = `${highPrice.toFixed(4)}`;
      lowPriceEl.textContent = `${lowPrice.toFixed(4)}`;
      volume24hEl.textContent = `${volume.toFixed(2)}`;
      
      // Update currency price
      currentPriceEl.textContent = `${parseFloat(tickerData.lastPrice).toFixed(4)}`;
      
      // Update change percentage
      priceChangePercentEl1.textContent = `${priceChangePercent.toFixed(2)}%`;
      priceChangePercentEl1.className = `price-change ${priceChangePercent >= 0 ? 'positive' : 'negative'}`;
      
      // Calculate volume change
      const volumeChangeValue = (Math.random() * 20 - 10).toFixed(2);
      volumeChangeEl.textContent = `${volumeChangeValue}%`;
      
      // Calculate average volume
      const avgVolumeValue = (volume / 24).toFixed(2);
      avgVolumeEl.textContent = `${avgVolumeValue}`;
      
      // Calculate liquidity ratio
      const liquidityRatioValue = (orderBook.bidTotal / orderBook.askTotal).toFixed(2);
      liquidityRatioEl.textContent = `${liquidityRatioValue}`;
      
      // Calculate trend strength
      const trendStrengthValue = Math.min(100, Math.abs(priceChangePercent) * 2).toFixed(0);
      trendStrengthEl.textContent = `${trendStrengthValue}%`;
      
      // Calculate momentum
      const momentumValue = (priceChangePercent > 0 ? 1 : -1) * (Math.abs(priceChangePercent) * 0.8 + Math.random() * 20).toFixed(0);
      momentumEl.textContent = `${momentumValue}`;
      
      // Calculate volatility
      const volatilityValue = ((highPrice - lowPrice) / currentPrice * 100).toFixed(2);
      volatilityEl.textContent = `${volatilityValue}%`;
      
      // Calculate Relative Strength Index (RSI)
      const rsiValue = (50 + (priceChangePercent > 0 ? 1 : -1) * Math.abs(priceChangePercent) * 0.5).toFixed(0);
      rsiEl.textContent = `${rsiValue}`;
      
      // Determine market trend
      let trend = "neutral";
      let trendIcon = "fa-exchange-alt";
      let trendColor = "neutral";
      let trendMessage = "Market is balanced";
      
      if (priceChangePercent > 1.5) {
        trend = "up";
        trendIcon = "fa-arrow-up";
        trendColor = "up";
        trendMessage = "Strong bullish trend";
      } else if (priceChangePercent < -1.5) {
        trend = "down";
        trendIcon = "fa-arrow-down";
        trendColor = "down";
        trendMessage = "Strong bearish trend";
      } else if (priceChangePercent > 0.5) {
        trend = "up";
        trendIcon = "fa-arrow-up";
        trendColor = "up";
        trendMessage = "Moderate bullish trend";
      } else if (priceChangePercent < -0.5) {
        trend = "down";
        trendIcon = "fa-arrow-down";
        trendColor = "down";
        trendMessage = "Moderate bearish trend";
      }
      
      // Moving averages analysis
      let maSignal = 'neutral';
      if (closingPrices && closingPrices.length > 200) {
        const sma50 = calculateSMA(closingPrices, 50);
        const sma200 = calculateSMA(closingPrices, 200);
        
        if (sma50.length > 0 && sma200.length > 0) {
          const lastSMA50 = sma50[sma50.length - 1];
          const lastSMA200 = sma200[sma200.length - 1];
          const prevSMA50 = sma50[sma50.length - 2] || lastSMA50;
          const prevSMA200 = sma200[sma200.length - 2] || lastSMA200;
    
          // Golden cross (buy signal)
          if (prevSMA50 < prevSMA200 && lastSMA50 > lastSMA200) {
            maSignal = 'bullish';
          }
          // Death cross (sell signal)
          else if (prevSMA50 > prevSMA200 && lastSMA50 < lastSMA200) {
            maSignal = 'bearish';
          }
        }
    
        // Combine signal with trend analysis
        if (maSignal === 'bullish' && trend !== 'down') {
          trend = 'up';
          trendMessage = 'Strong buy signal (Golden Cross)';
        } else if (maSignal === 'bearish' && trend !== 'up') {
          trend = 'down';
          trendMessage = 'Strong sell signal (Death Cross)';
        }
      }
      
      // Update market trend UI
      trendText.innerHTML = `<i class="fas ${trendIcon}"></i> ${trendMessage} (${priceChangePercent.toFixed(2)}%)`;
      marketTrendIndicator.className = `trend-indicator ${trendColor}`;
      
      // Generate recommendations based on trend
      let recommendation = "";
      
      if (trend === "up") {
        recommendation = "It is recommended to look for buying opportunities with focus on entering at support levels. Selling at strong resistance levels can be considered for taking profits.";
      } else if (trend === "down") {
        recommendation = "It is recommended to look for selling opportunities with focus on entering at resistance levels. Buying at strong support levels can be considered for taking profits during rebounds.";
      } else {
        recommendation = "It is recommended to wait until the market trend becomes clear or trade within a specific range between support and resistance.";
      }
      
      trendRecommendation.textContent = recommendation;
      
      return {
        trend,
        maSignal
      };
    }
    
    // Support/Resistance strength calculation function
    function calculateStrength(topLevels, orderData) {
      if (!topLevels.length || !orderData.length) return 0;
      
      // Calculate average volume in the top three levels
      const totalVolume = topLevels.slice(0, 3).reduce((sum, level) => sum + level.volume, 0);
      const avgVolume = totalVolume / 3;
      
      // Calculate relative strength (0-100%)
      const strength = (topLevels[0].volume / avgVolume) * 100;
      
      return Math.min(100, Math.round(strength));
    }
    
    // Profit/Loss percentage calculation function
    function calculateProfitPercentage(entry, target) {
      return (((target - entry) / entry) * 100).toFixed(2);
    }
    
    // Generate trading suggestions adjusted for small currencies
    function generateTradeSuggestions(bidData, askData, topSupports, topResists, currentPrice, marketTrend, maSignal) {
      const strategy = strategySelect.value;
      const isLarge = isLargeCap(currentSymbol);
      const suggestions = {
        buy: { suggested: false, reason: "", entry: 0, stop: 0, target1: 0, target2: 0 },
        sell: { suggested: false, reason: "", entry: 0, stop: 0, target1: 0, target2: 0 }
      };
      
      // Calculate relative strength of support and resistance
      const supportStrength = calculateStrength(topSupports, bidData);
      const resistStrength = calculateStrength(topResists, askData);
      
      // Update strength indicators
      supportIndicator.style.width = `${supportStrength}%`;
      resistIndicator.style.width = `${resistStrength}%`;
      supportValue.textContent = `${supportStrength}%`;
      resistValue.textContent = `${resistStrength}%`;
      supportStrengthSpan.textContent = `${supportStrength}%`;
      resistStrengthSpan.textContent = `${resistStrength}%`;
      
      // Determine strategy coefficients based on currency size
      let entryFactor, stopFactor, targetFactor1, targetFactor2;
      let minStrength = isLarge ? 60 : 40; // Lower minimum threshold for small currencies
      
      if (strategy === "aggressive") {
        entryFactor = isLarge ? 0.999 : 0.998;
        stopFactor = isLarge ? 0.995 : 0.99;
        targetFactor1 = isLarge ? 1.015 : 1.02;
        targetFactor2 = isLarge ? 1.03 : 1.04;
      } else if (strategy === "conservative") {
        entryFactor = isLarge ? 0.997 : 0.996;
        stopFactor = isLarge ? 0.98 : 0.97;
        targetFactor1 = isLarge ? 1.008 : 1.01;
        targetFactor2 = isLarge ? 1.015 : 1.02;
      } else { // balanced
        entryFactor = isLarge ? 0.998 : 0.997;
        stopFactor = isLarge ? 0.99 : 0.985;
        targetFactor1 = isLarge ? 1.01 : 1.015;
        targetFactor2 = isLarge ? 1.02 : 1.03;
      }
      
      // Analyze buy opportunities (considering market trend)
      if (topSupports.length > 0) {
        const strongSupport = topSupports[0];
        const supportDistance = Math.abs(strongSupport.price - currentPrice) / currentPrice;
        const maxDistance = isLarge ? 0.01 : 0.015; // Larger distance for small currencies
        
        // Buy opportunities are better in bullish or neutral trends
        if ((marketTrend === "up" || marketTrend === "neutral") && 
            supportStrength > minStrength && supportDistance < maxDistance) {
          suggestions.buy.suggested = true;
          suggestions.buy.reason = `${isLarge ? 'Strong' : 'Potential'} buy opportunity! Price is near ${isLarge ? 'strongest support' : 'support level'} (${strongSupport.price.toFixed(4)}) with ${supportStrength}% support strength`;
          
          // Adjust entry points to account for larger price differences for small currencies
          suggestions.buy.entry = (strongSupport.price * (isLarge ? entryFactor : entryFactor * 0.999)).toFixed(4);
          suggestions.buy.stop = (strongSupport.price * (isLarge ? stopFactor : stopFactor * 0.998)).toFixed(4);
          suggestions.buy.target1 = (strongSupport.price * (isLarge ? targetFactor1 : targetFactor1 * 1.002)).toFixed(4);
          suggestions.buy.target2 = (strongSupport.price * (isLarge ? targetFactor2 : targetFactor2 * 1.003)).toFixed(4);
          
          // Add alert
          if (supportStrength > (isLarge ? 70 : 50)) {
            tradingAlert.innerHTML = `
              <div class="alert-banner buy">
                <div class="alert-icon">
                  <i class="fas fa-bell fa-2x"></i>
                </div>
                <div class="alert-content">
                  <div class="alert-title">${isLarge ? 'Strong' : 'Potential'} Buy Opportunity!</div>
                  <div class="alert-message">Price is near ${isLarge ? 'strong' : 'good'} support level. Entry at: ${suggestions.buy.entry}</div>
                </div>
              </div>
            `;
          }
        }
      }
      
      // Analyze sell opportunities (considering market trend)
      if (topResists.length > 0) {
        const strongResist = topResists[0];
        const resistDistance = Math.abs(strongResist.price - currentPrice) / currentPrice;
        const maxDistance = isLarge ? 0.01 : 0.015; // Larger distance for small currencies
        
        // Sell opportunities are better in bearish or neutral trends
        if ((marketTrend === "down" || marketTrend === "neutral") && 
            resistStrength > minStrength && resistDistance < maxDistance) {
          suggestions.sell.suggested = true;
          suggestions.sell.reason = `${isLarge ? 'Strong' : 'Potential'} sell opportunity! Price is near ${isLarge ? 'strongest resistance' : 'resistance level'} (${strongResist.price.toFixed(4)}) with ${resistStrength}% resistance strength`;
          
          // Adjust entry points to account for larger price differences for small currencies
          suggestions.sell.entry = (strongResist.price * (isLarge ? (2 - entryFactor) : (2 - entryFactor * 1.001))).toFixed(4);
          suggestions.sell.stop = (strongResist.price * (isLarge ? (2 - stopFactor) : (2 - stopFactor * 1.002))).toFixed(4);
          suggestions.sell.target1 = (strongResist.price * (isLarge ? (2 - targetFactor1) : (2 - targetFactor1 * 0.998))).toFixed(4);
          suggestions.sell.target2 = (strongResist.price * (isLarge ? (2 - targetFactor2) : (2 - targetFactor2 * 0.997))).toFixed(4);
          
          // Add alert
          if (resistStrength > (isLarge ? 70 : 50)) {
            tradingAlert.innerHTML = `
              <div class="alert-banner sell">
                <div class="alert-icon">
                  <i class="fas fa-bell fa-2x"></i>
                </div>
                <div class="alert-content">
                  <div class="alert-title">${isLarge ? 'Strong' : 'Potential'} Sell Opportunity!</div>
                  <div class="alert-message">Price is near ${isLarge ? 'strong' : 'good'} resistance level. Entry at: ${suggestions.sell.entry}</div>
                </div>
              </div>
            `;
          }
        }
      }
      
      // Enhance suggestions with moving average signals
      if (maSignal === 'bullish' && supportStrength > 60) {
        suggestions.buy.suggested = true;
        suggestions.buy.reason = `Strong buy signal! Golden cross between moving averages + strong support (${supportStrength}%)`;
        suggestions.buy.entry = (Math.min(topSupports[0].price, currentPrice) * 0.998).toFixed(4);
      }
      
      if (maSignal === 'bearish' && resistStrength > 60) {
        suggestions.sell.suggested = true;
        suggestions.sell.reason = `Strong sell signal! Death cross between moving averages + strong resistance (${resistStrength}%)`;
        suggestions.sell.entry = (Math.max(topResists[0].price, currentPrice) * 1.002).toFixed(4);
      }
      
      // Update UI
      updateSuggestionsUI(suggestions);
      
      // Add suggestion to history
      if (suggestions.buy.suggested || suggestions.sell.suggested) {
        addToSuggestionHistory(suggestions, currentPrice);
      }
      
      return suggestions;
    }
    
    // Update suggestions UI function
    function updateSuggestionsUI(suggestions) {
      // Update buy suggestion
      buyReason.textContent = suggestions.buy.reason;
      buyEntry.textContent = suggestions.buy.entry || "--";
      buyStop.textContent = suggestions.buy.stop || "--";
      buyTarget1.textContent = suggestions.buy.target1 || "--";
      buyTarget2.textContent = suggestions.buy.target2 || "--";
      
      // Update profit percentages for buy
      if (suggestions.buy.suggested) {
        const entry = parseFloat(suggestions.buy.entry);
        const stop = parseFloat(suggestions.buy.stop);
        const target1 = parseFloat(suggestions.buy.target1);
        const target2 = parseFloat(suggestions.buy.target2);
        
        const stopLoss = calculateProfitPercentage(entry, stop);
        const profit1 = calculateProfitPercentage(entry, target1);
        const profit2 = calculateProfitPercentage(entry, target2);
        
        buyEntryPercentage.textContent = "";
        buyStopPercentage.textContent = `${stopLoss}%`;
        buyTarget1Percentage.textContent = `+${profit1}%`;
        buyTarget2Percentage.textContent = `+${profit2}%`;
        
        buyStopPercentage.className = "profit-percentage negative";
        buyTarget1Percentage.className = "profit-percentage positive";
        buyTarget2Percentage.className = "profit-percentage positive";
      } else {
        buyEntryPercentage.textContent = "";
        buyStopPercentage.textContent = "";
        buyTarget1Percentage.textContent = "";
        buyTarget2Percentage.textContent = "";
      }
      
      // Update sell suggestion
      sellReason.textContent = suggestions.sell.reason;
      sellEntry.textContent = suggestions.sell.entry || "--";
      sellStop.textContent = suggestions.sell.stop || "--";
      sellTarget1.textContent = suggestions.sell.target1 || "--";
      sellTarget2.textContent = suggestions.sell.target2 || "--";
      
      // Update profit percentages for sell
      if (suggestions.sell.suggested) {
        const entry = parseFloat(suggestions.sell.entry);
        const stop = parseFloat(suggestions.sell.stop);
        const target1 = parseFloat(suggestions.sell.target1);
        const target2 = parseFloat(suggestions.sell.target2);
        
        const stopLoss = calculateProfitPercentage(entry, stop);
        const profit1 = calculateProfitPercentage(entry, target1);
        const profit2 = calculateProfitPercentage(entry, target2);
        
        sellEntryPercentage.textContent = "";
        sellStopPercentage.textContent = `${stopLoss}%`;
        sellTarget1Percentage.textContent = `+${profit1}%`;
        sellTarget2Percentage.textContent = `+${profit2}%`;
        
        sellStopPercentage.className = "profit-percentage negative";
        sellTarget1Percentage.className = "profit-percentage positive";
        sellTarget2Percentage.className = "profit-percentage positive";
      } else {
        sellEntryPercentage.textContent = "";
        sellStopPercentage.textContent = "";
        sellTarget1Percentage.textContent = "";
        sellTarget2Percentage.textContent = "";
      }
      
      // Update card styles
      if (suggestions.buy.suggested) {
        buySuggestionCard.classList.remove('neutral');
        buySuggestionCard.classList.add('buy');
      } else {
        buySuggestionCard.classList.remove('buy');
        buySuggestionCard.classList.add('neutral');
      }
      
      if (suggestions.sell.suggested) {
        sellSuggestionCard.classList.remove('neutral');
        sellSuggestionCard.classList.add('sell');
      } else {
        sellSuggestionCard.classList.remove('sell');
        sellSuggestionCard.classList.add('neutral');
      }
    }
    
    // Add suggestion to history function
    function addToSuggestionHistory(suggestions, currentPrice) {
      const now = new Date();
      const timeString = now.toLocaleTimeString();
      
      // Add buy suggestion if available
      if (suggestions.buy.suggested) {
        const entry = parseFloat(suggestions.buy.entry);
        const stop = parseFloat(suggestions.buy.stop);
        const target1 = parseFloat(suggestions.buy.target1);
        const target2 = parseFloat(suggestions.buy.target2);
        
        const stopLoss = calculateProfitPercentage(entry, stop);
        const profit1 = calculateProfitPercentage(entry, target1);
        const profit2 = calculateProfitPercentage(entry, target2);
        
        const buySuggestion = {
          type: 'buy',
          time: timeString,
          price: currentPrice,
          entry: entry,
          stop: stop,
          target1: target1,
          target2: target2,
          stopLoss: stopLoss,
          profit1: profit1,
          profit2: profit2
        };
        
        tradeSuggestionsHistory.push(buySuggestion);
      }
      
      // Add sell suggestion if available
      if (suggestions.sell.suggested) {
        const entry = parseFloat(suggestions.sell.entry);
        const stop = parseFloat(suggestions.sell.stop);
        const target1 = parseFloat(suggestions.sell.target1);
        const target2 = parseFloat(suggestions.sell.target2);
        
        const stopLoss = calculateProfitPercentage(entry, stop);
        const profit1 = calculateProfitPercentage(entry, target1);
        const profit2 = calculateProfitPercentage(entry, target2);
        
        const sellSuggestion = {
          type: 'sell',
          time: timeString,
          price: currentPrice,
          entry: entry,
          stop: stop,
          target1: target1,
          target2: target2,
          stopLoss: stopLoss,
          profit1: profit1,
          profit2: profit2
        };
        
        tradeSuggestionsHistory.push(sellSuggestion);
      }
      
      // Update history UI
      updateSuggestionHistoryUI();
    }
    
    // Update suggestion history UI function
    function updateSuggestionHistoryUI() {
      // Keep only the latest 10 suggestions
      if (tradeSuggestionsHistory.length > 10) {
        tradeSuggestionsHistory = tradeSuggestionsHistory.slice(-10);
      }
      
      suggestionHistory.innerHTML = '';
      
      // Display suggestions from newest to oldest
      tradeSuggestionsHistory.slice().reverse().forEach(suggestion => {
        const item = document.createElement('div');
        item.className = 'history-item';
        
        const stopLossClass = suggestion.stopLoss > 0 ? 'positive' : 'negative';
        const profit1Class = suggestion.profit1 > 0 ? 'positive' : 'negative';
        const profit2Class = suggestion.profit2 > 0 ? 'positive' : 'negative';
        
        item.innerHTML = `
          <div class="history-action ${suggestion.type}">
            <i class="fas fa-${suggestion.type === 'buy' ? 'arrow-up' : 'arrow-down'}"></i>
            ${suggestion.type === 'buy' ? 'Buy' : 'Sell'}
          </div>
          <div class="history-details">
            <div>Entry Price: ${suggestion.entry.toFixed(4)}</div>
            <div>Stop Loss: ${suggestion.stop.toFixed(4)}</div>
            <div>Target 1: ${suggestion.target1.toFixed(4)}</div>
            <div>Target 2: ${suggestion.target2.toFixed(4)}</div>
          </div>
          <div class="history-percentage">
            <div class="${stopLossClass}">Stop: ${suggestion.stopLoss > 0 ? '+' : ''}${suggestion.stopLoss}%</div>
            <div class="${profit1Class}">Target 1: ${suggestion.profit1 > 0 ? '+' : ''}${suggestion.profit1}%</div>
            <div class="${profit2Class}">Target 2: ${suggestion.profit2 > 0 ? '+' : ''}${suggestion.profit2}%</div>
          </div>
          <div>${suggestion.time}</div>
        `;
        
        suggestionHistory.appendChild(item);
      });
    }
    
    // Update function
    async function updateOrderBook(symbol, limit) {
      // Reset alert when changing currency
      tradingAlert.innerHTML = '';
      
      const depthURL = `https://api.binance.com/api/v3/depth?symbol=${symbol}&limit=${limit}`;
      const priceURL = `https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`;
      const tickerURL = `https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`;
      
      try {
        // Show loading indicator
        loadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        loadBtn.disabled = true;
        
        const [depthRes, priceRes, tickerRes] = await Promise.all([
          fetch(depthURL),
          fetch(priceURL),
          fetch(tickerURL)
        ]);
        
        if (!depthRes.ok) throw new Error("Invalid symbol");
        if (!priceRes.ok) throw new Error("Failed to fetch price");
        if (!tickerRes.ok) throw new Error("Failed to fetch market data");
        
        const [depth, priceData, tickerData] = await Promise.all([
          depthRes.json(),
          priceRes.json(),
          tickerRes.json()
        ]);
        
        bidsTable.innerHTML = "";
        asksTable.innerHTML = "";
        
        let bidPrices = [], bidQtys = [], askPrices = [], askQtys = [];
        let bidTotal = 0, askTotal = 0;
        
        // Process buy orders
        depth.bids.forEach(([price, qty]) => {
          let p = parseFloat(price), q = parseFloat(qty);
          bidPrices.push(p); 
          bidQtys.push(q); 
          bidTotal += q;
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${p.toFixed(4)}</td>
            <td>${q.toFixed(4)}</td>
          `;
          bidsTable.appendChild(row);
        });
        
        // Process sell orders
        depth.asks.forEach(([price, qty]) => {
          let p = parseFloat(price), q = parseFloat(qty);
          askPrices.push(p); 
          askQtys.push(q); 
          askTotal += q;
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${p.toFixed(4)}</td>
            <td>${q.toFixed(4)}</td>
          `;
          asksTable.appendChild(row);
        });
        
        // Update statistics
        totalBidsSpan.textContent = bidTotal.toFixed(2);
        totalAsksSpan.textContent = askTotal.toFixed(2);
        highestBidSpan.textContent = bidPrices.length ? bidPrices[0].toFixed(4) : "--";
        lowestAskSpan.textContent = askPrices.length ? askPrices[0].toFixed(4) : "--";
        
        // Strongest support and resistance
        const maxBidQty = Math.max(...bidQtys);
        const maxAskQty = Math.max(...askQtys);
        const supportPrice = bidPrices[bidQtys.indexOf(maxBidQty)];
        const resistancePrice = askPrices[askQtys.indexOf(maxAskQty)];
        
        supportSpan.textContent = `${supportPrice.toFixed(4)} (${maxBidQty.toFixed(2)})`;
        resistSpan.textContent = `${resistancePrice.toFixed(4)} (${maxAskQty.toFixed(2)})`;
        
        // Top 3 support and resistance levels
        let topSupports = bidPrices.map((p, i) => ({ price: p, volume: bidQtys[i] }))
                               .sort((a, b) => b.volume - a.volume).slice(0, 3);
        
        let topResists = askPrices.map((p, i) => ({ price: p, volume: askQtys[i] }))
                              .sort((a, b) => b.volume - a.volume).slice(0, 3);
        
        // Update support list
        topSupportsList.innerHTML = '';
        topSupports.forEach((support, index) => {
          const li = document.createElement('li');
          li.className = 'level-item';
          li.innerHTML = `
            <div class="level-price">${support.price.toFixed(4)}</div>
            <div class="level-volume">${support.volume.toFixed(2)}</div>
          `;
          topSupportsList.appendChild(li);
        });
        
        // Update resistance list
        topResistsList.innerHTML = '';
        topResists.forEach((resist, index) => {
          const li = document.createElement('li');
          li.className = 'level-item';
          li.innerHTML = `
            <div class="level-price">${resist.price.toFixed(4)}</div>
            <div class="level-volume">${resist.volume.toFixed(2)}</div>
          `;
          topResistsList.appendChild(li);
        });
        
        // Update charts
        bidsChart.data.labels = bidPrices.map(p => p.toFixed(4));
        bidsChart.data.datasets[0].data = bidQtys;
        bidsChart.update();
        
        asksChart.data.labels = askPrices.map(p => p.toFixed(4));
        asksChart.data.datasets[0].data = askQtys;
        asksChart.update();
        
        currentPrice = parseFloat(priceData.price);
        const highestBid = bidPrices[0] || 0;
        const lowestAsk = askPrices[0] || 0;
        const now = new Date().toLocaleTimeString();
        
        priceChart.data.labels.push(now);
        priceChart.data.datasets[0].data.push(currentPrice);
        priceChart.data.datasets[1].data.push(highestBid);
        priceChart.data.datasets[2].data.push(lowestAsk);
        
        // Keep limited number of points in the chart
        if (priceChart.data.labels.length > 25) {
          priceChart.data.labels.shift();
          priceChart.data.datasets.forEach(ds => ds.data.shift());
        }
        
        // Fetch historical data for moving averages
        const historyURL = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=4h&limit=200`;
        const historyRes = await fetch(historyURL);
        const historyData = await historyRes.json();
        
        // Extract closing prices
        const closingPrices = historyData.map(k => parseFloat(k[4]));
        
        // Analyze market trend with moving averages
        const marketAnalysis = analyzeMarketTrend(tickerData, {
          bidTotal: bidTotal,
          askTotal: askTotal
        }, closingPrices);
        
        const marketTrend = marketAnalysis.trend;
        const maSignal = marketAnalysis.maSignal;
        
        // Update chart with moving averages
        if (closingPrices.length > 200) {
          const sma50 = calculateSMA(closingPrices, 50);
          const sma200 = calculateSMA(closingPrices, 200);
          updateChartWithMovingAverages(closingPrices, sma50, sma200);
        }
        
        // Generate suggestions with moving average signals
        generateTradeSuggestions(depth.bids, depth.asks, topSupports, topResists, 
                                currentPrice, marketTrend, maSignal);
        
      } catch (err) {
        alert(`âŒ ${err.message}`);
      } finally {
        // Reset load button
        loadBtn.innerHTML = '<i class="fas fa-download"></i> Load Data';
        loadBtn.disabled = false;
      }
    }
    
    // Manual load
    loadBtn.addEventListener("click", () => {
      currentSymbol = inputSymbol.value.trim().toUpperCase();
      currentLimit = parseInt(inputLimit.value);
      
      // Find currency name if it's in the list
      const selectedCurrency = popularCurrencies.find(c => c.symbol === currentSymbol);
      if (selectedCurrency) {
        currencyNameEl.textContent = selectedCurrency.name;
        currencySymbolEl.textContent = selectedCurrency.pair;
        
        // Update active button
        document.querySelectorAll('.currency-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.dataset.symbol === currentSymbol) {
            btn.classList.add('active');
          }
        });
      }
      
      updateOrderBook(currentSymbol, currentLimit);
    });
    
    // Auto-update every 5 seconds
    setInterval(() => updateOrderBook(currentSymbol, currentLimit), 5000);
    
    // Initial load
    createCurrencyButtons();
    updateOrderBook(currentSymbol, currentLimit);
    // Function to save card as image
function saveAsImage(elementId) {
  const element = document.getElementById(elementId);
  
  // Show loading indicator
  const saveBtn = element.querySelector('.save-btn');
  const originalHtml = saveBtn.innerHTML;
  saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
  saveBtn.disabled = true;
  
  html2canvas(element, {
    scale: 2, // Higher resolution
    backgroundColor: null,
    logging: false
  }).then(canvas => {
    const link = document.createElement('a');
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    
    // File name: trade-type-date
    const fileName = `trading-${elementId === 'buy-suggestion' ? 'buy' : 'sell'}-${timestamp}.png`;
    
    link.download = fileName;
    link.href = canvas.toDataURL('image/png');
    link.click();
    
    // Restore button to original state
    saveBtn.innerHTML = originalHtml;
    saveBtn.disabled = false;
    
    // Show success alert
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert-banner buy';
    alertDiv.style.position = 'fixed';
    alertDiv.style.top = '20px';
    alertDiv.style.right = '20px';
    alertDiv.style.zIndex = '1000';
    alertDiv.innerHTML = `
      <div class="alert-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="alert-content">
        <div class="alert-title">Saved Successfully!</div>
        <div class="alert-message">Image saved as: ${fileName}</div>
      </div>
    `;
    
    document.body.appendChild(alertDiv);
    
    // Remove alert after 3 seconds
    setTimeout(() => {
      alertDiv.remove();
    }, 3000);
  });
}
///////////////
// Function to save card as text
function saveAsText(elementId) {
  const element = document.getElementById(elementId);
  const isBuy = elementId === 'buy-suggestion';
  
  // Show loading indicator
  const saveBtns = element.querySelectorAll('.save-btn');
  const originalHtml = saveBtns[1].innerHTML;
  saveBtns[1].innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
  saveBtns[1].disabled = true;
  
  // Collect trade data
  const title = element.querySelector('.suggestion-title').textContent;
  const reason = element.querySelector('.suggestion-reason').textContent;
  const entry = element.querySelector('#buy-entry, #sell-entry').textContent;
  const stop = element.querySelector('#buy-stop, #sell-stop').textContent;
  const target1 = element.querySelector('#buy-target1, #sell-target1').textContent;
  const target2 = element.querySelector('#buy-target2, #sell-target2').textContent;
  
  // Percentages
  const stopPercentage = element.querySelector('#buy-stop-percentage, #sell-stop-percentage').textContent;
  const target1Percentage = element.querySelector('#buy-target1-percentage, #sell-target1-percentage').textContent;
  const target2Percentage = element.querySelector('#buy-target2-percentage, #sell-target2-percentage').textContent;
  
  // Get currency name and symbol from UI
  const currencyName = document.getElementById('currency-name').textContent;
  const currencySymbol = document.getElementById('currency-symbol').textContent;
  
  // Create file content
  const content = `
    ${title} - ${new Date().toLocaleString()}
    ====================================
    
    Currency: ${currencyName} (${currencySymbol})
    
    ${reason}
    
    Trade Details:
    - Entry Price: ${entry}
    - Stop Loss: ${stop} (${stopPercentage})
    - Target 1: ${target1} (${target1Percentage})
    - Target 2: ${target2} (${target2Percentage})
    
    Notes:
    - These recommendations are for educational purposes only
    - Risk management is very important in trading
    - Do not risk more than 1-2% of capital on a single trade
  `;
  
  // Create text file for download
  const link = document.createElement('a');
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  const fileName = `trading-${isBuy ? 'buy' : 'sell'}-${currencySymbol.replace('/', '-')}-${timestamp}.txt`;
  
  link.download = fileName;
  link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(content);
  link.click();
  
  // Restore button to original state
  saveBtns[1].innerHTML = originalHtml;
  saveBtns[1].disabled = false;
  
  // Show success alert
  const alertDiv = document.createElement('div');
  alertDiv.className = 'alert-banner buy';
  alertDiv.style.position = 'fixed';
  alertDiv.style.top = '20px';
  alertDiv.style.right = '20px';
  alertDiv.style.zIndex = '1000';
  alertDiv.innerHTML = `
    <div class="alert-icon">
      <i class="fas fa-check-circle"></i>
    </div>
    <div class="alert-content">
      <div class="alert-title">Saved Successfully!</div>
      <div class="alert-message">Text file saved as: ${fileName}</div>
    </div>
  `;
  
  document.body.appendChild(alertDiv);
  
  // Remove alert after 3 seconds
  setTimeout(() => {
    alertDiv.remove();
  }, 3000);
}
/////////////////////
//////////////
let recorder;
let recording = false;
let frames = [];
const FPS = 10; // Frames per second

// Start recording
async function startVideoRecording(elementId) {
  const element = document.getElementById(elementId);
  const saveBtn = element.querySelectorAll('.save-btn')[2];
  const originalHtml = saveBtn.innerHTML;
  
  saveBtn.innerHTML = '<i class="fas fa-circle"></i> Recording...';
  saveBtn.style.background = 'linear-gradient(135deg, #ff0000, #cc0000)';
  recording = true;
  frames = [];
  
  // Record 5 seconds (duration can be adjusted)
  const duration = 5000; 
  let elapsed = 0;
  const interval = 1000 / FPS;
  
  const captureFrame = async () => {
    if (!recording) return;
    
    const canvas = await html2canvas(element, { scale: 1 });
    frames.push(canvas);
    
    elapsed += interval;
    if (elapsed < duration) {
      setTimeout(captureFrame, interval);
    } else {
      stopVideoRecording(elementId, originalHtml);
    }
  };
  
  captureFrame();
}

// Stop recording and save video
function stopVideoRecording(elementId, originalHtml) {
  recording = false;
  const element = document.getElementById(elementId);
  const saveBtn = element.querySelectorAll('.save-btn')[2];
  
  saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  
  // Create video from frames
  const canvas = document.createElement('canvas');
  canvas.width = frames[0].width;
  canvas.height = frames[0].height;
  const ctx = canvas.getContext('2d');
  
  // Convert frames to video
  const stream = canvas.captureStream(0);
  recorder = new RecordRTC(stream, {
    type: 'video',
    mimeType: 'video/webm',
    frameRate: FPS
  });
  
  // Draw frames on Canvas
  let currentFrame = 0;
  const drawFrame = () => {
    if (currentFrame >= frames.length) {
      recorder.stopRecording(() => {
        const blob = recorder.getBlob();
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        link.download = `trading-${elementId === 'buy-suggestion' ? 'buy' : 'sell'}-${timestamp}.webm`;
        link.href = url;
        link.click();
        
        saveBtn.innerHTML = originalHtml;
        saveBtn.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
        
        // Show alert
        showAlert('Video saved successfully!', 'success');
      });
      return;
    }
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(frames[currentFrame], 0, 0);
    currentFrame++;
    setTimeout(drawFrame, 1000 / FPS);
  };
  
  recorder.startRecording();
  drawFrame();
}

// Helper function to show alerts
function showAlert(message, type) {
  const alertDiv = document.createElement('div');
  alertDiv.className = `alert-banner ${type}`;
  alertDiv.style.position = 'fixed';
  alertDiv.style.top = '20px';
  alertDiv.style.right = '20px';
  alertDiv.style.zIndex = '1000';
  alertDiv.innerHTML = `
    <div class="alert-icon">
      <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
    </div>
    <div class="alert-content">
      <div class="alert-title">${type === 'success' ? 'Success' : 'Warning'}</div>
      <div class="alert-message">${message}</div>
    </div>
  `;
  
  document.body.appendChild(alertDiv);
  
  setTimeout(() => {
    alertDiv.remove();
  }, 3000);
}
/////////////////


function saveMarketAnalysis() {
  // Collect basic analysis data
  const currencyName = document.getElementById('currency-name').textContent;
  const currencySymbol = document.getElementById('currency-symbol').textContent;
  const currentPrice = document.getElementById('current-price').textContent;
  const trendText = document.getElementById('trend-text').textContent;
  const priceChange = document.getElementById('price-change').textContent;
  const priceChangePercent = document.getElementById('price-change-percent1').textContent;
  const highPrice = document.getElementById('high-price').textContent;
  const lowPrice = document.getElementById('low-price').textContent;
  const volume24h = document.getElementById('volume-24h').textContent;
  const trendStrength = document.getElementById('trend-strength').textContent;
  const recommendation = document.getElementById('trend-recommendation').textContent;
  
  // Collect support and resistance data
  const supportStrength = document.getElementById('support-strength').textContent;
  const resistStrength = document.getElementById('resist-strength').textContent;
  
  // Collect top 3 support levels
  const supportItems = document.querySelectorAll('#top-supports .level-item');
  let supportsText = '';
  supportItems.forEach((item, index) => {
    const price = item.querySelector('.level-price').textContent;
    const volume = item.querySelector('.level-volume').textContent;
    supportsText += `  ${index + 1}. Price: ${price} - Volume: ${volume}\n`;
  });
  
  // Collect top 3 resistance levels
  const resistItems = document.querySelectorAll('#top-resists .level-item');
  let resistsText = '';
  resistItems.forEach((item, index) => {
    const price = item.querySelector('.level-price').textContent;
    const volume = item.querySelector('.level-volume').textContent;
    resistsText += `  ${index + 1}. Price: ${price} - Volume: ${volume}\n`;
  });

  // Analysis date
  const analysisDate = new Date().toLocaleString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });

  // Create file content with support and resistance
  const content = `
Market Trend Analysis - ${analysisDate}

ðŸ“Œ Currency: ${currencyName} (${currencySymbol})
ðŸ’° Current Price: ${currentPrice}

ðŸ“ˆ Market Trend: ${trendText}
ðŸ“Š Price Change: ${priceChange} (${priceChangePercent})
â¬†ï¸ High Price: ${highPrice}
â¬‡ï¸ Low Price: ${lowPrice}
ðŸ“Š Trading Volume (24h): ${volume24h}
âš¡ Trend Strength: ${trendStrength}

ðŸ”µ Support Levels:
${supportsText}

ðŸ”´ Resistance Levels:
${resistsText}

ðŸ“Œ Recommendations:
${recommendation}

ðŸ“‹ Notes:
- This analysis is automatically generated based on real-time data
- Support/Resistance levels are based on order book volume
- It is recommended to review fundamental analysis before making trading decisions
- Risk management is very important in all trades

â° Update Time: ${new Date().toLocaleTimeString()}
  `;

  // Create file for download
  const link = document.createElement('a');
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  link.download = `market-analysis-${currencySymbol.replace('/', '-')}-${timestamp}.txt`;
  link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(content);
  link.click();

  // Show alert
  showAlert('Market analysis saved successfully!', 'success');
}

  </script>
</body>
</html>